(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{325:function(s,a,t){"use strict";t.r(a);var e=t(33),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"基于githubaction自动部署vuepress项目到github-pages"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基于githubaction自动部署vuepress项目到github-pages"}},[s._v("#")]),s._v(" 基于githubAction自动部署vuepress项目到github pages")]),s._v(" "),t("p",[s._v("github Action是一套自动化任务流，可以自动把项目部署到任意想部署的环境，不需要执行额外的工作，对于需要频繁部署过项目的开发者，一定会明白这个工具的重要性。")]),s._v(" "),t("h3",{attrs:{id:"新建任务流文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#新建任务流文件"}},[s._v("#")]),s._v(" 新建任务流文件")]),s._v(" "),t("p",[s._v("在项目根目录下，新建.github/workflows/nodejs.yml。这里的目录是固定的。nodejs是配置文件的名字，你可以取其他的名字，后缀名yml是固定的")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("|.github\n|--|workflows\n|--|--|nodejs.yml\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"任务流名字"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#任务流名字"}},[s._v("#")]),s._v(" 任务流名字")]),s._v(" "),t("p",[s._v("给自动脚本取一个名字，Node.js CI，可以取任意的名字")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Node.js CI\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"监听指定的分支提交"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#监听指定的分支提交"}},[s._v("#")]),s._v(" 监听指定的分支提交")]),s._v(" "),t("p",[s._v("在这个示例中，监听了develop分支的push操作，每当develop分支发生push行为时，将自动执行接下来的steps。branches是一个数组，可以填写多个分支的名字")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("on")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("push")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("branches")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" develop "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"执行命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#执行命令"}},[s._v("#")]),s._v(" 执行命令")]),s._v(" "),t("p",[s._v("run代表要执行的命令，一个任务中，可能执行多个命令。当deveop发生push时，仓库自动执行npm install 和 npm run build 命令")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("run")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token scalar string"}},[s._v("\n    npm install \n    npm run build --if-present")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),t("p",[s._v("注意要在run后面加|，表示后面的命令在同一个上下文环境中执行")])]),s._v(" "),t("h3",{attrs:{id:"部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#部署"}},[s._v("#")]),s._v(" 部署")]),s._v(" "),t("p",[s._v("引用peaceiris/actions-gh-pages@v3，提前添加deploy_key，当监听到develop分支的代码提交后，如果我们想把编译后的文件部署到master分支上，则配置publish_branch为master，vuepress编译后的文件是在dist目录，publish_dir用来指定dist目录。这样action奇偶可以自动把dist目录下面的文件全部推送到master分支上")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Deploy\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("uses")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" peaceiris/actions"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("gh"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pages@v3\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("with")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("deploy_key")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" $"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" secrets.ACTIONS_DEPLOY_KEY "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("publish_branch")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" master\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("publish_dir")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ./.vuepress/dist\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h3",{attrs:{id:"添加deploy-key"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#添加deploy-key"}},[s._v("#")]),s._v(" 添加deploy_key")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在命令行执行")]),s._v("\nssh"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("keygen "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("t rsa "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("b 4096 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('C "$(git config user.email)" '),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f gh"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pages "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v('N ""\n'),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 你会得到两个文件:")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   gh-pages.pub (public key)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   gh-pages     (private key)")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("接着, 打开仓库设置页面")]),s._v(" "),t("p",[s._v("点击Deploy Keys，添加public key，同时勾选Allow write access")]),s._v(" "),t("p",[s._v("点击Secrets，添加private key，命名为ACTIONS_DEPLOY_KEY")]),s._v(" "),t("h3",{attrs:{id:"action市场"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#action市场"}},[s._v("#")]),s._v(" Action市场")]),s._v(" "),t("p",[s._v("很多项目的部署命令都是类似的，完全没必要从头写。github也发现了这个问题，所以提供了Action市场。每个人可以贡献自己写的Action，当然也可以去use别人的action，比如有一个peaceiris/actions-gh-pages@v3的action，去引用它")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("uses")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" peaceiris/actions"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("gh"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pages@v3\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("如果你想查看这个action的原命令，拼接链接。下面是peaceiris/actions-gh-pages@v3的🔗")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/peaceiris/actions-gh-pages",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/peaceiris/actions-gh-pages"),t("OutboundLink")],1)]),s._v(" "),t("h3",{attrs:{id:"参考"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[s._v("#")]),s._v(" 参考")]),s._v(" "),t("p",[t("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2019/09/getting-started-with-github-actions.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("GitHub Actions 入门教程"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2015/09/continuous-integration.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("持续集成"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2016/07/yaml.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("yaml语法参看"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/marketplace/actions/github-pages-action",target:"_blank",rel:"noopener noreferrer"}},[s._v("github-pages-action配置"),t("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=n.exports}}]);